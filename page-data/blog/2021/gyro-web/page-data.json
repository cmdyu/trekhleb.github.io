{"componentChunkName":"component---src-templates-post-tsx-content-file-path-src-posts-2021-gyro-web-index-mdx","path":"/blog/2021/gyro-web/","result":{"data":{"mdx":{"id":"029f9f55-46ef-5468-81dd-448141c224d0","body":"\nimport Alert, { InfoAlert } from '../../../components/shared/Alert';\nimport InteractivePostArea from '../../../components/shared/InteractivePostArea';\nimport OrientationInfo from './components/OrientationInfo';\nimport GyroCube from './components/GyroCube';\n\n<div className=\"mt-3\">\n  <Alert type={InfoAlert}>\n    Read this article on your mobile device to make the interactive examples work\n  </Alert>\n</div>\n\n## Accessing device orientation in pure JavaScript\n\nIn Javascript you may access your device orientation data by listening to the [deviceorientation](https://developer.mozilla.org/en-US/docs/Web/API/Detecting_device_orientation) event. It is as easy as the following:\n\n```javascript\nwindow.addEventListener('deviceorientation', handleOrientation);\n\nfunction handleOrientation(event) {\n  const alpha = event.alpha;\n  const beta = event.beta;\n  const gamma = event.gamma;\n  // Do stuff...\n}\n```\n\nHere is the meaning of the `alpha`, `beta` and `gama` angles:\n\n![device orientation](./assets/01-cover.jpg)\n\n_Image source: [newnow.co](https://newnow.co/me-myself-and-i/)_\n\n**But!** Not every browser allows you to access the orientation data without user's permission. For example, in iOS 13 Apple has introduced the [requestPermission](https://www.w3.org/TR/orientation-event/#dom-deviceorientationevent-requestpermission) method. It must be triggered on user action (click, tap or equivalent).\n\nThe example of accessing the device orientation becomes a bit more complicated:\n\n```javascript\nfunction onClick() {\n  if (typeof DeviceMotionEvent.requestPermission === 'function') {\n    // Handle iOS 13+ devices.\n    DeviceMotionEvent.requestPermission()\n      .then((state) => {\n        if (state === 'granted') {\n          window.addEventListener('devicemotion', handleOrientation);\n        } else {\n          console.error('Request to access the orientation was rejected');\n        }\n      })\n      .catch(console.error);\n  } else {\n    // Handle regular non iOS 13+ devices.\n    window.addEventListener('devicemotion', handleOrientation);\n  }\n}\n```\n\nTry to turn the toggle below on and see what angle values your device is reporting.\n\n<InteractivePostArea>\n  <OrientationInfo />\n</InteractivePostArea>\n\n## Debugging the orientation access in the browser\n\nIn case if you're using the desktop device you may imitate the device rotation from the \"Sensors\" tab in dev-tools:\n\n![testing in chrome](./assets/02-chrome-testing.jpg)\n\nCool! So now we have the access to device orientation, and we can even test it in the browser!\n\n## React hook for accessing the device orientation\n\nThe last step I would like to take is to come up with the [React hook](https://reactjs.org/docs/hooks-intro.html), that will encapsulate the orientation fetching for me, and make it easier to use it in the React components (like the one that displayed the angles to you above).\n\nHere is an example of the `useDeviceOrientation.ts` hook, that is written in TypeScript:\n\n```typescript\nimport { useCallback, useEffect, useState } from 'react';\n\ntype DeviceOrientation = {\n  alpha: number | null,\n  beta: number | null,\n  gamma: number | null,\n}\n\ntype UseDeviceOrientationData = {\n  orientation: DeviceOrientation | null,\n  error: Error | null,\n  requestAccess: () => Promise<boolean>,\n  revokeAccess: () => Promise<void>,\n};\n\nexport const useDeviceOrientation = (): UseDeviceOrientationData => {\n  const [error, setError] = useState<Error | null>(null);\n  const [orientation, setOrientation] = useState<DeviceOrientation | null>(null);\n\n  const onDeviceOrientation = (event: DeviceOrientationEvent): void => {\n    setOrientation({\n      alpha: event.alpha,\n      beta: event.beta,\n      gamma: event.gamma,\n    });\n  };\n\n  const revokeAccessAsync = async (): Promise<void> => {\n    window.removeEventListener('deviceorientation', onDeviceOrientation);\n    setOrientation(null);\n  };\n\n  const requestAccessAsync = async (): Promise<boolean> => {\n    if (!DeviceOrientationEvent) {\n      setError(new Error('Device orientation event is not supported by your browser'));\n      return false;\n    }\n\n    if (\n      DeviceOrientationEvent.requestPermission\n      && typeof DeviceMotionEvent.requestPermission === 'function'\n    ) {\n      let permission: PermissionState;\n      try {\n        permission = await DeviceOrientationEvent.requestPermission();\n      } catch (err) {\n        setError(err);\n        return false;\n      }\n      if (permission !== 'granted') {\n        setError(new Error('Request to access the device orientation was rejected'));\n        return false;\n      }\n    }\n\n    window.addEventListener('deviceorientation', onDeviceOrientation);\n\n    return true;\n  };\n\n  const requestAccess = useCallback(requestAccessAsync, []);\n  const revokeAccess = useCallback(revokeAccessAsync, []);\n\n  useEffect(() => {\n    return (): void => {\n      revokeAccess();\n    };\n  }, [revokeAccess]);\n\n  return {\n    orientation,\n    error,\n    requestAccess,\n    revokeAccess,\n  };\n};\n```\n\nThe hook might be used as follows:\n\n```tsx\nimport React from 'react';\nimport Toggle  from './Toggle';\nimport { useDeviceOrientation } from './useDeviceOrientation';\n\nconst OrientationInfo = (): React.ReactElement => {\n  const { orientation, requestAccess, revokeAccess, error } = useDeviceOrientation();\n\n  const onToggle = (toggleState: boolean): void => {\n    const result = toggleState ? requestAccess() : revokeAccess();\n  };\n\n  const orientationInfo = orientation && (\n    <ul>\n      <li>É‘: <code>{orientation.alpha}</code></li>\n      <li>Î²: <code>{orientation.beta}</code></li>\n      <li>Î³: <code>{orientation.gamma}</code></li>\n    </ul>\n  );\n\n  const errorElement = error ? (\n    <div className=\"error\">{error.message}</div>\n  ) : null;\n\n  return (\n    <>\n      <Toggle onToggle={onToggle} />\n      {orientationInfo}\n      {errorElement}\n    </>\n  );\n};\n\nexport default OrientationInfo;\n```\n\n## Demo\n\nFinally, having the access to the device orientation, let's imitate a 3D space, and a possibility to look at the object from a 3D perspective by rotating your mobile device. Imagine you have a virtual shopping item, and you want to see it from different angles and sides before putting it into your basket.\n\nWe will use a simple 3D cube which is made with pure CSS by using the [perspective](https://css-tricks.com/almanac/properties/p/perspective/), [perspective-origin](https://css-tricks.com/almanac/properties/p/perspective-origin/) and [transform](https://css-tricks.com/almanac/properties/t/transform/) properties (you may find the full example with styles [on css-tricks.com](https://css-tricks.com/how-css-perspective-works/)).\n\nHere we go, here is our Gyro-Cube that you should be able to see from the different angles depending on your device orientation!\n\n<InteractivePostArea>\n  <GyroCube />\n</InteractivePostArea>\n\nYou may find all the code examples from this article (including the Gyro-cube styles) in [trekhleb.github.io](https://github.com/trekhleb/trekhleb.github.io/tree/master/src/posts/2021/gyro-web/components/) repo.\n\nIn case if you're reading the article from the laptop, here's how the demo should work on mobile devices:\n\n![demo](./assets/03-demo-02.gif)\n\nI hope this example was useful for you! I also hope that you will come up with much more interesting and realistic use-case for the device orientation than the Gyro-Cube above ðŸ˜„ Happy coding!\n","fields":{"slug":"/blog/2021/gyro-web/"},"internal":{"contentFilePath":"/home/runner/work/trekhleb.github.io/trekhleb.github.io/src/posts/2021/gyro-web/index.mdx"},"frontmatter":{"title":"Gyro-web: Accessing the device orientation in JavaScript","summary":"Accessing the device orientation using React hook, and rotating a CSS 3D cube afterwards","date":"02 March, 2021","cover":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB3KDQn//EABYQAQEBAAAAAAAAAAAAAAAAAAAhAf/aAAgBAQABBQLFV//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAABD/2gAIAQEABj8Cf//EABgQAAMBAQAAAAAAAAAAAAAAAAABIRFB/9oACAEBAAE/IWbMqijh/9oADAMBAAIAAwAAABCID//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAQACAwEAAAAAAAAAAAAAAAEAIRExQZH/2gAIAQEAAT8QSb2TgA4quwAC+J//2Q==","aspectRatio":3.3783783783783785,"src":"/static/8248abb946ae6143ba9a719ea0612031/cd8c4/01-cover.jpg","srcSet":"/static/8248abb946ae6143ba9a719ea0612031/d2e8d/01-cover.jpg 250w,\n/static/8248abb946ae6143ba9a719ea0612031/55b1d/01-cover.jpg 500w,\n/static/8248abb946ae6143ba9a719ea0612031/cd8c4/01-cover.jpg 862w","sizes":"(max-width: 862px) 100vw, 862px"}}}}}},"pageContext":{"slug":"/blog/2021/gyro-web/","frontmatter":{"title":"Gyro-web: Accessing the device orientation in JavaScript","summary":"Accessing the device orientation using React hook, and rotating a CSS 3D cube afterwards","cover":"assets/01-cover.jpg","date":"2021-03-02T00:00:00.000Z"}}},"staticQueryHashes":[],"slicesMap":{}}